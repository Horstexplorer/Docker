# Reverse proxy matching hostname
# args[0] = hostname
# args[1] = proxy destination
(hostname_reverse_proxy) {
  @{args[0]} host {args[0]}
  handle @{args[0]}  {
    reverse_proxy {args[1]}
  }
}

# Reverse proxy matching hostname, with limited access by private range ips
# args[0] = hostname
# args[1] = proxy destination
(local_only_hostname_reverse_proxy) {
  @{args[0]} host {args[0]}
  handle @{args[0]}  {
    import allow_local_access_only
    reverse_proxy {args[1]}
  }
}

# Reverse proxy matching hostname, with limited access by private range ips
# args[0] = hostname
# args[1] = proxy destination
(local_only_hostname_tls_reverse_proxy) {
  @{args[0]} host {args[0]}
  handle @{args[0]}  {
    import allow_local_access_only
    reverse_proxy https://{args[1]} {
      transport http {
        tls_insecure_skip_verify
      }
    }
  }
}